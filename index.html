<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- SEO -->
    <title>Relatorio</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,700,700i%7CMaitree:200,300,400,600,700&amp;subset=latin-ext" rel="stylesheet">

    <!-- CSS WebSlides -->
    <link rel="stylesheet" type='text/css' media='all' href="static/css/webslides.css">

    <!-- Optional - CSS SVG Icons (Font Awesome) -->
    <link rel="stylesheet" type='text/css' media='all' href="static/css/svg-icons.css">
	
    <!-- FAVICONS -->
    <link rel="icon" href="static/images/favicons/favicon.png">

    <!-- Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#333333">

<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/maps.js"></script>
<script src="https://www.amcharts.com/lib/4/geodata/brazilLow.js"></script>
<script src="https://www.amcharts.com/lib/4/plugins/bullets.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/kelly.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

<script>
am4core.ready(function() {

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

// Create map instance
var chart = am4core.create("participationRegionDiv", am4maps.MapChart);
chart.maxZoomLevel = 32;
chart.chartContainer.wheelable = false;
// Set map definition
chart.geodata = am4geodata_brazilLow;

// Set projection


// Add button
var zoomOut = chart.tooltipContainer.createChild(am4core.ZoomOutButton);
zoomOut.align = "right";
zoomOut.valign = "top";
zoomOut.margin(20, 20, 20, 20);
zoomOut.events.on("hit", function() {
  if (currentSeries) {
    currentSeries.hide();
  }
  chart.goHome();
  zoomOut.hide();
  currentSeries = regionalSeries.BR.series;
  currentSeries.show();
});
zoomOut.hide();


// Create map polygon series
var polygonSeries = chart.series.push(new am4maps.MapPolygonSeries());
polygonSeries.useGeodata = true;
polygonSeries.calculateVisualCenter = true;

// Configure series
var polygonTemplate = polygonSeries.mapPolygons.template;
polygonTemplate.tooltipText = "{name}";
polygonTemplate.fill = "green";

// Start Hover
var hs = polygonTemplate.states.create("hover");
hs.properties.fill = am4core.color("darkgreen");

polygonSeries.calculateVisualCenter = true;
polygonTemplate.tooltipPosition = "fixed";

var selected;
function selectCountry(id) {
  if (selected) {
    selected.isHover = false;
  }
  selected = polygonSeries.getPolygonById(id);
  selected.isHover = true;
}

polygonTemplate.events.on("hover", function(ev) {
  if (ev.target != selected) {
    selected.isHover = false;
  }
  
  // This is needed so that "unhovering" previous polygon does not hide tooltip
  ev.target.isHover = false;
  ev.target.isHover = true;
  });
  // End Hover

// Load data when map polygons are ready
chart.events.on("ready", loadStores);

var chartData = {"query_results":[  
      {  
         "MAIL_ST_PROV_C":"PR",
         "LNGTD_I":"-49.0946",
         "LATTD_I":"-25.0075",
         "mail_city_n":"Curitiba",
         "count":10
      },
      {  
         "MAIL_ST_PROV_C":"PR",
         "LNGTD_I":"-42.0946",
         "LATTD_I":"-21.0075",
         "mail_city_n":"Sao Jose dos Pinhais",
         "count":5
      }
   ]}
// Loads store data
function loadStores() {
  var loader = new am4core.DataSource();
  loader.url = "https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-160/TargetStores.json";
  loader.events.on("parseended", function(ev) {
    setupStores(chartData);
  });
  loader.load();
}

// Creates a series
function createSeries(heatfield) {
  var series = chart.series.push(new am4maps.MapImageSeries());
  series.dataFields.value = heatfield;

  var template = series.mapImages.template;
  template.verticalCenter = "middle";
  template.horizontalCenter = "middle";
  template.propertyFields.latitude = "lat";
  template.propertyFields.longitude = "long";
  template.tooltipText = "{name}:\n[bold]{stores} fornecedores[/]";

  var circle = template.createChild(am4core.Circle);
  circle.radius = 10;
  circle.fillOpacity = 0.7;
  circle.verticalCenter = "middle";
  circle.horizontalCenter = "middle";
  circle.nonScaling = true;

  var label = template.createChild(am4core.Label);
  label.text = "{stores}";
  label.fill = am4core.color("#fff");
  label.verticalCenter = "middle";
  label.horizontalCenter = "middle";
  label.nonScaling = true;

  var heat = series.heatRules.push({
    target: circle,
    property: "radius",
    min: 10,
    max: 30
  });

  // Set up drill-down
  series.mapImages.template.events.on("hit", function(ev) {

    // Determine what we've clicked on
    var data = ev.target.dataItem.dataContext;
	if (data.type == 'city')
	{
		return;
    }
    // No id? Individual store - nothing to drill down to further
    if (!data.target) {
      return;
    }

    // Create actual series if it hasn't been yet created
    if (!regionalSeries[data.target].series) {
      regionalSeries[data.target].series = createSeries("count");
      regionalSeries[data.target].series.data = data.markerData;
    }

    // Hide current series
    if (currentSeries) {
      currentSeries.hide();
    }

    // Control zoom
    if (data.type == "state") {
      var statePolygon = polygonSeries.getPolygonById("BR-" + data.state);
      chart.zoomToMapObject(statePolygon);
    }
    zoomOut.show();

    // Show new targert series
    currentSeries = regionalSeries[data.target].series;
    currentSeries.show();
  });

  return series;
}

var regionalSeries = {};
var currentSeries;

function setupStores(data) {

  // Init country-level series
  regionalSeries.BR = {
    markerData: [],
    series: createSeries("stores")
  };

  // Set current series
  currentSeries = regionalSeries.BR.series;

  // Process data
  am4core.array.each(data.query_results, function(store) {

    // Get store data
    var store = {
      state: store.MAIL_ST_PROV_C,
      long: am4core.type.toNumber(store.LNGTD_I),
      lat: am4core.type.toNumber(store.LATTD_I),
      location: store.co_loc_n,
      city: store.mail_city_n,
      count: am4core.type.toNumber(store.count)
    };

    // Process state-level data
    if (regionalSeries[store.state] == undefined) {
      var statePolygon = polygonSeries.getPolygonById("BR-" + store.state);
      if (statePolygon) {

        // Add state data
        regionalSeries[store.state] = {
          target: store.state,
          type: "state",
          name: statePolygon.dataItem.dataContext.name,
          count: store.count,
          stores: store.count,
          lat: statePolygon.visualLatitude,
          long: statePolygon.visualLongitude,
          state: store.state,
          markerData: []
        };
        regionalSeries.BR.markerData.push(regionalSeries[store.state]);

      }
      else {
        // State not found
        return;
      }
    }
    else {
      regionalSeries[store.state].stores += store.count;
      regionalSeries[store.state].count += store.count;
    }

    // Process city-level data
    if (regionalSeries[store.city] == undefined) {
      regionalSeries[store.city] = {
        target: store.city,
        type: "city",
        name: store.city,
        count: store.count,
        stores: store.count,
        lat: store.lat,
        long: store.long,
        state: store.state,
        markerData: []
      };
      regionalSeries[store.state].markerData.push(regionalSeries[store.city]);
    }
    else {
      regionalSeries[store.city].stores += store.count;
      regionalSeries[store.city].count += store.count;
    }

  });

  regionalSeries.BR.series.data = regionalSeries.BR.markerData;
}

}); // end am4core.ready()
</script>

<script>
am4core.ready(function() {

// Themes begin
am4core.useTheme(am4themes_kelly);
am4core.useTheme(am4themes_animated);
// Themes end

/**
 * Define data for each year
 */
var chartData = {
  "2018": [
    { "sector": "ME", "size": 100 },
    { "sector": "NÃO-ME", "size": 50 } ],
  "2019": [
    { "sector": "ME", "size": 60 },
    { "sector": "NÃO-ME", "size": 40 } ],
  "2020": [
    { "sector": "ME", "size": 40 },
    { "sector": "NÃO-ME", "size": 60 } ],
  "2021": [
    { "sector": "ME", "size": 35 },
    { "sector": "NÃO-ME", "size": 65 } ]
};

// Create chart instance
var chart = am4core.create("MEDiv", am4charts.PieChart);

// Add data
chart.data = [
  { "sector": "ME", "size": 45 },
  { "sector": "NÃO-ME", "size": 55 }
];
chart.legend = new am4charts.Legend();
// Add label
chart.innerRadius = 100;
var label = chart.seriesContainer.createChild(am4core.Label);
label.text = "2018";
label.horizontalCenter = "middle";
label.verticalCenter = "middle";
label.fontSize = 50;

// Add and configure Series
var pieSeries = chart.series.push(new am4charts.PieSeries());
pieSeries.dataFields.value = "size";
pieSeries.dataFields.category = "sector";
pieSeries.colors.list = [
    new am4core.color('green'),
    new am4core.color('yellow'),
]
pieSeries.labels.template.disabled = true;
pieSeries.ticks.template.disabled = true;


// Animate chart data
var currentYear = 2018;
function getCurrentData() {
  label.text = currentYear;
  var data = chartData[currentYear];
  currentYear++;
  if (currentYear > 2021)
    currentYear = 2018;
  return data;
}

function loop() {
  //chart.allLabels[0].text = currentYear;
  var data = getCurrentData();
  for(var i = 0; i < data.length; i++) {
    chart.data[i].size = data[i].size;
  }
  chart.invalidateRawData();
  chart.setTimeout( loop, 4000 );
}

loop();

}); // end am4core.ready()
</script>
  
 <script>

am4core.ready(function() {

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

var chart = am4core.create('chartdiv', am4charts.XYChart)

chart.language.locale["_decimalSeparator"] = ",";
chart.language.locale["_thousandSeparator"] = "."; 

chart.colors.step = 1;

chart.legend = new am4charts.Legend()
chart.legend.position = 'top'
chart.legend.paddingBottom = 20
chart.legend.labels.template.maxWidth = 95

var xAxis = chart.xAxes.push(new am4charts.CategoryAxis())
xAxis.dataFields.category = 'category'
xAxis.renderer.cellStartLocation = 0.1
xAxis.renderer.cellEndLocation = 0.9
xAxis.renderer.grid.template.location = 0;

var yAxis = chart.yAxes.push(new am4charts.ValueAxis());
yAxis.min = 0;

function createSeries(value, name, color) {
    var series = chart.series.push(new am4charts.ColumnSeries())
    series.dataFields.valueY = value
    series.dataFields.categoryX = 'category'
    series.name = name
	series.fill = am4core.color(color);
	series.stroke = am4core.color(color);
	series.columns.template.tooltipText = "R$ {valueY}";

    series.events.on("hidden", arrangeColumns);
    series.events.on("shown", arrangeColumns);

    var bullet = series.bullets.push(new am4charts.LabelBullet())
    bullet.interactionsEnabled = false
    bullet.dy = 30;
    bullet.label.text = '{valueY}'
    bullet.label.fill = am4core.color('#ffffff')

    return series;
}

chart.data = [
    {
        category: 'JAN',
        first: 500.1,
        second: 300,
        third: 200
    },
    {
        category: 'FEV',
        first: 1000,
        second: 900,
        third: 100
    },
    {
        category: 'MAR',
        first: 1500,
        second: 1000,
        third: 500
    },
    {
        category: 'ABR',
        first: 5000,
        second: 3300,
        third: 1700
    }
	,
    {
        category: 'MAI',
        first: 5000,
        second: 3300,
        third: 1700
    }
	,
    {
        category: 'JUN',
        first: 5000,
        second: 3300,
        third: 1700
    }
	,
    {
        category: 'JUL',
        first: 5000,
        second: 3300,
        third: 1700
    }
	,
    {
        category: 'AGO',
        first: 5000,
        second: 3300,
        third: 1700
    }
]


createSeries('first', 'Referência', 'blue');
createSeries('second', 'Adjudicado', 'red');
createSeries('third', 'Economia', 'green');

function arrangeColumns() {

    var series = chart.series.getIndex(0);

    var w = 1 - xAxis.renderer.cellStartLocation - (1 - xAxis.renderer.cellEndLocation);
    if (series.dataItems.length > 1) {
        var x0 = xAxis.getX(series.dataItems.getIndex(0), "categoryX");
        var x1 = xAxis.getX(series.dataItems.getIndex(1), "categoryX");
        var delta = ((x1 - x0) / chart.series.length) * w;
        if (am4core.isNumber(delta)) {
            var middle = chart.series.length / 2;

            var newIndex = 0;
            chart.series.each(function(series) {
                if (!series.isHidden && !series.isHiding) {
                    series.dummyData = newIndex;
                    newIndex++;
                }
                else {
                    series.dummyData = chart.series.indexOf(series);
                }
            })
            var visibleCount = newIndex;
            var newMiddle = visibleCount / 2;

            chart.series.each(function(series) {
                var trueIndex = chart.series.indexOf(series);
                var newIndex = series.dummyData;

                var dx = (newIndex - trueIndex + middle - newMiddle) * delta

                series.animate({ property: "dx", to: dx }, series.interpolationDuration, series.interpolationEasing);
                series.bulletsContainer.animate({ property: "dx", to: dx }, series.interpolationDuration, series.interpolationEasing);
            })
        }
    }
}
var scrollbarX = new am4charts.XYChartScrollbar();
chart.scrollbarX = scrollbarX;
chart.scrollbarX.parent = chart.bottomAxesContainer;
}); // end am4core.ready()
</script> 

</head> 
 <body>

    <main role="main">
      <article id="webslides" class="vertical">
        <!-- Quick Guide
          - Each parent <section> in the <article id="webslides"> element is an individual slide.
          - Vertical sliding = <article id="webslides" class="vertical">
          - <div class="wrap"> = container 90% / <div class="wrap size-50"> = 45%;
        -->
		<section class="printableA">
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
			  <div style="width:100%; height:100%;max-width:30vw;margin:auto">
				<img style="margin:0 auto;display:block" src="static/images/logos/logo.svg">
				</div>
                <h3 align="center"><strong>Demonstração de resultados 2020</strong></h3>
				<h3 align="center">Prefeitura Municipal de Teste - PR</h3>
                
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>
		
        <section class="printableA">
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>Participação nacional</strong></h3>
                <p class="text-intro">Fornecedores filtrados por <strong>estados</strong> e <strong>cidades</strong></p>
                <p>O estado mais ativo em seus editais foi o <strong>PARANÁ</strong> com <strong>15</strong> fornecedores, enquanto a cidade com mais fornecedores foi <strong>CURITIBA</strong> com <strong>10</strong> fornecedores.
				Ainda, <strong>15</strong> fornecedores de sua cidade participaram de seus processos.</p>
              </div>
              <!-- .end .column -->
              <div class="column" style="min-width:60vw;">
			  <div class="amChartDivs" style="min-height:70vh;padding-bottom:50px" id="participationRegionDiv"></div>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>
		
		<section class="printableA">
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>Participação de Microempresas</strong></h3>
                <p>Seu órgão teve a participação de <strong>50 (50%)</strong> empresas ME e <strong>50 (50%)</strong> que não se encaixam nessa modalidade.</p>
              </div>
              <!-- .end .column -->
              <div class="column" style="min-width:60vw;">
			  <div class="amChartDivs" style="min-height:70vh;padding-bottom:50px" id="MEDiv"></div>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>
		
		<section class="printableA">
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>Economia por mês</strong></h3>
                <p>O mês que gerou maior economia foi <strong>JANEIRO</strong> com <strong>R$ 123.245,65 (52%)</strong> de economia. Sua economia anual foi de <strong><strong>R$ 1.123.245,65 (32%)</strong></strong>.</p>
              </div>
              <!-- .end .column -->
              <div class="column amChartDivs" style="min-width:60vw;">
			  <div class="amChartDivs" style="min-height:70vh;padding-bottom:50px" id="chartdiv"></div>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>
		

      </article>
      <!-- end article -->
    </main>
    <!-- end main -->

    <!-- Required -->
    <script src="static/js/webslides.js"></script>
    <script>
	<!-- WebSlides.registerPlugin('scroll', function(){}); -->

     window.ws = new WebSlides();

    </script>

    <!-- OPTIONAL - svg-icons.js (fontastic.me - Font Awesome as svg icons) -->
    <script defer src="static/js/svg-icons.js"></script>

  </body>
</html>
